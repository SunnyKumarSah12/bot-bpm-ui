<div *ngIf="demand" class="view-container">
  <div class="header">
    <h2>{{ demand.role }} - {{ demand.accountName }}</h2>
    <button *ngIf="mode === 'view'" mat-icon-button color="primary" (click)="goToEdit()" matTooltip="Edit Demand">
      <mat-icon>edit</mat-icon>
    </button>
  </div>

  <mat-divider></mat-divider>

  <mat-tab-group>
    <!-- ðŸ”¹ Tab 1: Details -->
    <mat-tab label="Details">
      <div class="info-section">
        <div><strong>Demand ID:</strong> {{ demand.id || 'TBD' }}</div>
        <div><strong>Client:</strong> {{ demand.clientName }}</div>
        <div><strong>{{ formLabels.accountName }}:</strong> {{ demand.accountName }}</div>
        <div><strong>{{ formLabels.divisionName }}:</strong> {{ demand.divisionName }}</div>
        <div><strong>{{ formLabels.subdivisionName }}:</strong> {{ demand.subdivisionName }}</div>
        <div><strong>Status:</strong> {{ demand.demandStatus }}</div>
        <div><strong>Priority:</strong> {{ demand.priority }}</div>
        <div><strong>Location:</strong> {{ demand.location }}</div>
        <div><strong>CreatedBy:</strong> {{ demand.createdBy }}</div>
        <div><strong>Created On:</strong> {{ demand.demandCreationDate | date: 'short' }}</div>
        <div><strong>End Date:</strong> {{ demand.demandEndDate | date: 'short' }}</div>
        <div><strong>Interview Date & Time:</strong> {{ demand.interviewDateTime | date: 'long' }}</div>

        <div><strong>Primary Skillset:</strong> {{ demand.primarySkillset }}</div>
        <div><strong>Secondary Skillset:</strong> {{ demand.secondarySkillset }}</div>
        <div><strong>Role:</strong> {{ demand.role }}</div>
        <div><strong>Role Level:</strong> {{ demand.roleLevel }}</div>
        <div><strong>YOE:</strong> {{ demand.yoeMin }} - {{ demand.yoeMax }}</div>

        <div><strong>Recruiter:</strong> {{ demand.recruiterName }} - {{ demand.recruiterEmail }}</div>
        <div><strong>Competency:</strong> {{ demand.competency }}</div>
        <div><strong>EyCompetencyHead:</strong> {{ demand.eyCompetencyHead }} - {{ demand.eyCompetencyHeadEmail }}</div>
        <div><strong>EyTaSpoc:</strong> {{ demand.eyTaSpoc }} - {{ demand.eyTaSpocEmail }}</div>
        <div><strong>EyEvaluationSpoc:</strong> {{ demand.eyEvaluationSpoc }} - {{ demand.eyEvaluationSpocEmail }}</div>

        <div><strong>{{ formLabels.clientEvaluationSpoc }}:</strong> {{ demand.clientEvaluationSpoc }} - {{
          demand.clientEvaluationSpocEmail }}</div>
        <div><strong>{{ formLabels.clientCalibrationSpoc }}:</strong> {{ demand.clientCalibrationSpoc }} - {{
          demand.clientCalibrationSpocEmail }}</div>
        <div><strong>{{ formLabels.clientHiringManager }}:</strong> {{ demand.clientHiringManager }} - {{
          demand.clientHiringManagerEmail }}</div>
      </div>
    </mat-tab>
    <mat-tab label="Job Description">

      <div class="jd-scrollable-content">
        <div class="jd-header-button-row-div">
          <!-- <div *ngIf="editJDMode" class="jd-header button-row" style="gap: 4px; margin-bottom: 4px;">
            <button class="edit-jd-button" mat-raised-button color="primary" (click)="saveJDChanges()">Save</button>
            <button class="edit-jd-button" mat-button (click)="cancelJDChanges()">Cancel</button>
          </div> -->
          <div class="jd-header" style="margin-top: 5px;">
            <!-- <button mat-icon-button (click)="toggleJDMode()" [matTooltip]="editJDMode ? 'View' : 'Edit JD'">
              <mat-icon style="font-size: 18px;">{{ editJDMode ? 'visibility' : 'edit' }}</mat-icon>
            </button> -->
            <button mat-icon-button matTooltip="Download Job Description" (click)="downloadJD()">
              <mat-icon>download</mat-icon>
            </button>
          </div>
        </div>

        <div *ngIf="!editJDMode">
          <h3>Job Description</h3>
          <p class="jd-text">
            {{ demand.jobDescription || 'N/A' }}
          </p>
          <h3>Calibration Input</h3>
          <p class="jd-text">
            {{ demand.calibrationInput || 'N/A' }}
          </p>
        </div>

        <div *ngIf="editJDMode">
          <mat-form-field appearance="fill" class="w-full jd-edit-container">
            <mat-label>Job Description</mat-label>
            <textarea matInput [(ngModel)]="demand.jobDescription" class="jd-textarea"></textarea>
          </mat-form-field>

          <mat-form-field appearance="fill" class="w-full jd-edit-container">
            <mat-label>Calibration Input</mat-label>
            <textarea matInput [(ngModel)]="demand.calibrationInput" class="jd-textarea"></textarea>
          </mat-form-field>

        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<div *ngIf="!demand" class="no-data">
  <p>Demand not found.</p>
</div>